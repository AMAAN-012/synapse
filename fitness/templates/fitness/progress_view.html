{% extends 'fitness/fitness_base.html' %}

{% block title %}My Progress{% endblock %}

{% block content %}
<div class="space-y-8">
    <h1 class="text-4xl font-bold text-white mb-6">My Progress Dashboard</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="bg-slate-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-4">Total Volume Over Time (kg)</h2>
            {% if line_labels|length > 2 %}
                <div class="relative h-80">
                    <canvas id="volumeLineChart"></canvas>
                </div>
            {% else %}
                <div class="text-center text-slate-400 py-10">
                    <p>Log workouts on at least two different days to see your progress trend.</p>
                </div>
            {% endif %}
        </div>

        <div class="bg-slate-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-4">Exercise Volume Distribution</h2>
            {% if doughnut_labels|length > 0 %}
                <div class="relative h-80">
                    <canvas id="exerciseDoughnutChart"></canvas>
                </div>
            {% else %}
                <div class="text-center text-slate-400 py-10">
                    <p>No workout data available to show distribution.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    {% if line_labels|length < 3 %}
    <div class="text-center pt-4">
        <a href="{% url 'fitness:add_workout' %}" class="mt-4 inline-block bg-lime-500 hover:bg-lime-600 text-slate-900 font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
            Log a Workout
        </a>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const lineCtx = document.getElementById('volumeLineChart');
    if (lineCtx) {
        const lineLabels = {{ line_labels|safe }};
        const lineData = {{ line_data|safe }};

        // Creating a gradient fill for a premium look
        const gradient = lineCtx.getContext('2d').createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(163, 230, 53, 0.5)'); 
        gradient.addColorStop(1, 'rgba(163, 230, 53, 0)');   

        new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: lineLabels,
                datasets: [{
                    label: 'Total Volume (kg)',
                    data: lineData,
                    backgroundColor: gradient, 
                    borderColor: '#a3e635',   
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#a3e635',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 7,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#a3e635'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#94a3b8' } },
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#94a3b8' } }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    const doughnutCtx = document.getElementById('exerciseDoughnutChart');
    if (doughnutCtx) {
        const doughnutLabels = {{ doughnut_labels|safe }};
        const doughnutData = {{ doughnut_data|safe }};

        new Chart(doughnutCtx, {
            type: 'doughnut',
            data: {
                labels: doughnutLabels,
                datasets: [{
                    label: 'Volume (kg)',
                    data: doughnutData,
                    backgroundColor: [ 
                        '#a3e635', 
                        '#4f46e5', 
                        '#db2777', 
                        '#f97316', 
                        '#0891b2', 
                        '#d946ef'  
                    ],
                    borderColor: '#1e293b',
                    borderWidth: 2,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#94a3b8', 
                            padding: 15,
                            font: { size: 12 }
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}